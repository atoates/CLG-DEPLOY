import"./config-B88kdatl.js";function v(){const o=typeof window<"u"&&window.BACKEND_URL?window.BACKEND_URL:"";if(o)return o;try{const t=window.location.hostname||"";if(t&&t!=="localhost"&&t!=="127.0.0.1")return"https://app.crypto-lifeguard.com"}catch{}return""}function s(o){return`${v()}${o}`}function d(o,t={}){return fetch(o,{credentials:"include",...t})}const E=["BTC","ETH","USDC","MATIC","DOGE","ADA","SOL","POL","UNI","LINK"],A=document.getElementById("token-datalist");E.forEach(o=>{const t=document.createElement("option");t.value=o,A.appendChild(t)});const C=document.getElementById("alert-form"),i=document.getElementById("msg"),l=document.getElementById("submit-btn"),g=document.getElementById("form-token"),T=document.getElementById("form-severity"),I=document.getElementById("form-title"),S=document.getElementById("form-description"),B=document.getElementById("form-info"),m=document.getElementById("form-deadline"),p=document.getElementById("form-source-type"),y=document.getElementById("form-source-url"),k=document.getElementById("tag-selectors"),D={"price-change":{icon:"📊",label:"Price Change",color:"#4ade80"},migration:{icon:"🔄",label:"Migration",color:"#60a5fa"},hack:{icon:"🔓",label:"Hack",color:"#f87171"},fork:{icon:"🔱",label:"Fork",color:"#a78bfa"},scam:{icon:"⚠️",label:"Scam",color:"#fbbf24"},airdrop:{icon:"🪂",label:"Airdrop",color:"#34d399"},whale:{icon:"🐋",label:"Whale Alert",color:"#818cf8"},news:{icon:"📰",label:"News",color:"#94a3b8"},community:{icon:"👥",label:"Community",color:"#fb923c"},exploit:{icon:"⚡",label:"Exploit",color:"#f43f5e"},privacy:{icon:"🛡️",label:"Privacy",color:"#22c55e"},"community-vote":{icon:"🗳️",label:"Community Vote",color:"#8b5cf6"},"token-unlocks":{icon:"�",label:"Token Unlocks",color:"#f59e0b"}};Object.entries(D).forEach(([o,t])=>{const e=document.createElement("button");e.className="tag-filter",e.setAttribute("data-tag",o),e.setAttribute("aria-pressed","false"),e.style.color=t.color;const n=document.createElement("span");n.className="icon",n.textContent=t.icon;const a=document.createElement("span");a.textContent=t.label,e.appendChild(n),e.appendChild(a),e.addEventListener("click",r=>{r.preventDefault(),e.classList.toggle("active"),e.setAttribute("aria-pressed",e.classList.contains("active"))}),k.appendChild(e)});(function(){try{g.focus()}catch{}const t=new Date,e=new Date(t.getTime()+6*3600*1e3),n=r=>String(r).padStart(2,"0"),a=`${e.getFullYear()}-${n(e.getMonth()+1)}-${n(e.getDate())}T${n(e.getHours())}:${n(e.getMinutes())}`;m.min=a,m.value=a})();function L(o){if(!o)return null;const t=new Date(o);return isNaN(t.getTime())?null:t.toISOString()}async function N(o){try{const t=await d(s("/api/me"));if(!t.ok)return;const e=await t.json(),n=Array.isArray(e.watchlist)?e.watchlist.slice():[];n.includes(o)||n.push(o),await d(s("/api/me/prefs"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({watchlist:n,severity:Array.isArray(e.severity)?e.severity:["critical","warning","info"],showAll:!!e.showAll,dismissed:Array.isArray(e.dismissed)?e.dismissed:[]})})}catch{}}C.addEventListener("submit",async o=>{o.preventDefault();const t=(g.value||"").trim().toUpperCase(),e=T.value,n=(I.value||"").trim(),a=(S.value||"").trim(),r=(B.value||"").trim(),u=m.value,b=p&&p.value||"",h=(y&&y.value||"").trim();if(!t||!e||!n||!a||!u){i.textContent="Please complete all fields.";return}const f=L(u);if(!f){i.textContent="Invalid deadline.";return}l.disabled=!0,l.textContent="Saving…",i.textContent="";const w=[...document.querySelectorAll(".tag-filter.active")].map(c=>c.getAttribute("data-tag")).filter(Boolean);try{const c=await d(s("/api/alerts"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t,severity:e,title:n,description:a,deadline:f,tags:w,further_info:r,source_type:b,source_url:h})});if(!c.ok)throw new Error(`HTTP ${c.status}`);await N(t),i.textContent="Alert created ✔ Redirecting…",setTimeout(()=>{window.location.href="/"},700)}catch(c){console.error(c),i.textContent="Failed to save alert. Please try again.",l.disabled=!1,l.textContent="Create alert"}});
